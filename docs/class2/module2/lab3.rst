.. |labmodule| replace:: 2
.. |labnum| replace:: 3
.. |labdot| replace:: |labmodule|\ .\ |labnum|
.. |labund| replace:: |labmodule|\ _\ |labnum|
.. |labname| replace:: Lab\ |labdot|
.. |labnameund| replace:: Lab\ |labund|

Lab |labmodule|\.\ |labnum|\: 「f5-newman-wrapper」ツールの紹介
------------------------------------------------------------

以前のラボで示したように、Postman GUIを使用してコレクションやフォルダを手動で実行し、BIG-IPデバイスの最終結果を得ることができます。 この機能はテスト段階では重要ですが、これらの手動手順を自動プロセスとして実行できるようにする必要があります。

この目標を達成するために、「f5-newman-wrapper」ツールを使用できます。 このツールを使用すると、ユーザーはワークフローをJSON形式のファイルで指定できます。 このワークフローには、入力変数、実行するコレクションとフォルダ、プログラム的な方法で実行するためのフィードバックを提供するさまざまな出力オプションが含まれます。

「f5-newman-wrapper」によって実行可能なワークフローの中核要素は、JSON形式の入力ファイルです。 このラボでは、ファイル形式を紹介します。

Task 1 - ワークフローの入力ファイルの紹介
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

ワークフローファイルの形式を紹介するために、以前のラボで手動で実行した簡単なワークフローを再作成する例を使用します。 まず、セクション毎でファイルを解析し、その後ファイル全体を確認します。


名前と説明を定義
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: json
   :linenos:

   {
        "name":"Wrapper_Demo_1",
        "description":"Execute a chained workflow that authenticates to a BIG-IP and retrieves it's software version"
   }


実行時のグローバル設定を定義
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

このセクションでは、「f5-newman-wrapper」がこのワークフローをどのように実行するかを定義します。 属性は以下の表で説明されています。

.. code-block:: json
   :linenos:

   {
        "globalEnvVars":"../framework/f5-postman-workflows.postman_globals.json",
        "globalOptions": {
            "insecure":true,
            "reporters":["cli"]
        },
        "saveEnvVars":true,
        "outputFile":"Wrapper_Demo_1-run.json",
        "envOutputFile":"Wrapper_Demo_1-env.json"
    }

.. list-table::
    :header-rows: 1
    :widths: 20 80
    :stub-columns: 1

    * - **Attribute**
      - **Description**
    * - ``globalEnvVars``
      - This is the file that contains the Global environment variables used
        by Newman.  This file is generated by the f5-postman-workflows build
        scripts and contains the same global variables as we saw in the previous
        lab that installed the framework into the Postman GUI client
    * - ``globalOptions``
      - Specify the global options for newman.  Available options are documented
        at: https://github.com/postmanlabs/newman#api-reference

        .. NOTE:: Removing the ``cli`` option from the ``reporters`` array will
           disable verbose CLI output

    * - ``saveEnvVars``
      - Save the environment variables at the end of the run to a file
    * - ``outputFile``
      - The file to save the run details to.
    * - ``envOutputFile``
      - The file to save the environment variables at the end of the run to.


入力変数を定義
~~~~~~~~~~~~~~~~~~~~~~

このセクションでは、ワークフローの入力変数を指定します。 ``globalVars``　という名前は、ここで定義された変数が、定義されたワークフロー（ワークフローの視点からのグローバルスコープ）の各要求に対して存在することを意味します。 変数は、ワークフローの各項目（項目の観点から見たローカルスコープ）内で定義することもできます。 同じ名前のグローバル変数とローカル変数の場合は、ローカルスコープ変数が優先されます。

.. code-block:: json
   :linenos:

    {
        "globalVars": {
            "bigip_mgmt": "10.1.1.4",
            "bigip_username":"admin",
            "bigip_password":"admin"
        }
    }



ワークフローコレクションとオーダーの定義
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

このセクションでは、構成されているワークフロー、コレクションおよびフォルダを定義します。 ``workflow``　属性は、実行する各コレクションとフォルダを定義するオブジェクトを含む順序付けられた配列です。

.. code-block:: json
   :linenos:

    {
       "workflow": [
           {
               "name":"Authenticate to BIG-IP",
               "options": {
                   "collection":".. /collections/BIG_IP/BIGIP_API_Authentication.postman_collection.json",
                   "folder":"1_Authenticate"
               }
           },
           {
               "name":"Get BIG-IP Software Version",
               "options": {
                   "collection":"../collections/BIG_IP/BIGIP_Operational_Workflows.postman_collection.json",
                   "folder":"4A_Get_BIGIP_Version"
               }
           }
       ]
   }

認証を実行するワークフロー内の項目を見てみましょう：

.. code-block:: json
   :linenos:

                   {
                           "name":"Authenticate to BIG-IP",
                           "options": {
                                   "collection":".. /collections/BIG_IP/BIGIP_API_Authentication.postman_collection.json",
                                   "folder":"1_Authenticate"
                           }
                   }

``name``　属性は、このアイテムの名前を指定します。 ``options``　オブジェクトは、この特定の項目を実行するために使用されるパラメータを指定します。 この場合、 ``collection``　属性は ``BIGIP_API_Authentication``　コレクションを含むファイルを参照します。 ``folder``　属性は、コレクション内で実行するフォルダの名前を指定します。

デフォルトでは、コレクションまたはフォルダのすべての出力変数は、ワークフローの次の項目に渡されます。 これにより、コレクションを連鎖させてワークフローを構築することができます。

Workflow JSONファイル全体
~~~~~~~~~~~~~~~~~~~

.. code-block:: json
   :linenos:

   {
           "name":"Wrapper_Demo_1",
           "description":"Execute a chained workflow that authenticates to a BIG-IP    and retrieves it's software version",
           "globalEnvVars":"../framework/f5-postman-workflows.postman_globals.json",
           "globalOptions": {
                   "insecure":true,
                   "reporters":["cli"]
           },
           "globalVars": {
                   "bigip_mgmt": "10.1.1.4",
                   "bigip_username":"admin",
                   "bigip_password":"admin"
           },
           "saveEnvVars":true,
           "outputFile":"Wrapper_Demo_1-run.json",
           "envOutputFile":"Wrapper_Demo_1-env.json",
           "workflow": [
                   {
                           "name":"Authenticate to BIG-IP",
                           "options": {
                                   "collection":"..   /collections/BIG_IP/BIGIP_API_Authentication.   postman_collection.json",
                                   "folder":"1_Authenticate"
                           }
                   },
                   {
                           "name":"Get BIG-IP Software Version",
                           "skip":false,
                           "options": {
                                   "collection":"..   /collections/BIG_IP/BIGIP_Operational_Workflows.   postman_collection.json",
                                   "folder":"4A_Get_BIGIP_Version"
                           }
                   }
           ]
   }
